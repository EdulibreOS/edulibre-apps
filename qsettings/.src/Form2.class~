' Gambas class file

Public cx As New Connection
Public rs As Result
Private sNameTheme As String
Private sCodTheme As Integer
Private hImage As Image

Public Sub _new()
  
  cx = M_DB.Connect()
  rs = cx.Exec("select * from tbDat LIMIT 20")
  
  Grid.Columns.Count = 3
  Grid.Rows.Height = 100
  Grid.Columns.Ascending = True
  Grid.columns[0].width = 100
  Grid.Columns[0].Alignment = Align.Center
  Grid.Columns[1].Expand = True
  Grid.columns[2].width = -1
  'Grid.Rows.Border = True
  Grid.Foreground = &708090& '&00235E9A&
  'Grid.Columns[0].Background = &204a87& 'Color.Merge(Color.LightBackground, Color.White, 0.5) 'Color.Gradient(Color.TextBackground, Color.TextForeground, 0.7) ' &00142B3F&
  Grid.Rows.Count = rs.Count 
  
  DownloadFile
  
End

Public Sub DownloadFile()
  
  Dim i As Integer
  
  Do While rs.Available 
    Inc i
    
    hGetFileClient.URL = rs!Screenshot
    hGetFileClient.TimeOut = 0
    hGetFileClient.Async = True
    hGetFileClient.Get([], User.Home &/ rs!Cod & ".png")
    
    ' Wait 2
    'ListViewImage.Add(rs!Name, rs!Name, Picture[User.Home &/ "test" & i & ".png"].Image.Stretch(128, 72).Picture)
    
    rs.MoveNext 
  Loop 
Catch
  
End

Public Sub hGetFileClient_connect()
  
  ' Message("Started")
  BtnInstall.Text = "Install"
  
End 

Public Sub hGetFileClient_Error()
  
  hGetFileClient.Stop()
  Message("error")
  
End

Public Sub hGetFileClient_Finished()
  
  hGetFileClient.Stop()
  ' Message("done")
  'Catch
  
End 

Public Sub FillsList()
  
  Dim i As Integer
  
  rs = cx.Exec("SELECT * FROM tbDat where Name LIKE '%" & txtSearch.Text & "%'")
  Grid.Rows.Count = rs.Count 
  For i = 0 To rs.Count - 1
    Grid.columns.count = 3
    Grid.Columns[1].Expand = True
    Grid.columns[2].width = 0
    
    Grid[i, 0].Picture = Picture[User.Home &/ rs!Cod & ".png"].Image.Stretch(92, 52).Picture
    Grid[i, 1].RichText = "<b><u><font color=#005FBF>" & rs!Name & "</u></b>"
    'Grid[i, 1].RichText = "<html><body><h5><a style=color:#80BFFF>" & rs!Name & "</h5></body></html>"
    Grid[i, 1].RichText &= "<br><font size=-1>" & "By " & rs!By & "</font>"
    Grid[i, 1].RichText &= "<br><font size=-1>" & rs!Info & "</font>"
    Grid[i, 1].RichText &= "<br><font size=-1>" & rs!Download & " Downloads" & "</font>"
    Grid[i, 2].Picture = Picture[User.Home &/ rs!Cod & ".png"]
    
    rs.MoveNext
  Next
  
Catch
  
End

Public Sub txtSearch_Change()
  
  rs = cx.Exec("SELECT * FROM tbDat where Name LIKE '%" & txtSearch.Text & "%'")
  FillsList()
  
End

Public Sub Grid_Data(Row As Integer, Column As Integer)
  
  rs.moveTo(row)
  FillsList
  
End

Public Sub Grid_Change()
  
  PictureBox1.Picture = Grid[Grid.Row, 2].Picture 
  
End
