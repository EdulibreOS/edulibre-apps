' Gambas class file

Public hGetFileClient As New HttpClient As "hGetFileClient" Private sDownloadBuffer As String
Public cx As New Connection
Public rs As Result

Public Sub Form_Open()
  
  Dim sTheme_Name As String
  Dim i As Integer
  Dim s As String
  
  cx = M_DB.Connect()
  rs = cx.Exec("select * from tbDat order by Name desc")
  
End

Public Sub ListViewImage_Click()
  
End

Public Sub DownloadFile()
  
  Dim i As Integer
  
  ' cx = M_DB.Connect()
  ' rs = cx.Exec("select * from tbDat order by Name desc")
  
  'hGetFileClient.URL = TextBox1.Text
  'hGetFileClient.TimeOut = 0
  'hGetFileClient.Async = True
  'hGetFileClient.Get([], Desktop.ConfigDir &/ "Innova/Wallpaper" &/ "GambasTest")
  Do While rs.Available 
    Inc i
    
    ' PictureBox1.Picture = Picture[User.home & i & ".jpg"] 
    ' PictureBox1.Refresh 
    
    'If rs!Name <> "" Then 
    
    hGetFileClient.URL = rs!Screenshot
    hGetFileClient.TimeOut = 0
    hGetFileClient.Async = True
    hGetFileClient.Get([], User.Home &/ "test" & i & ".png")
    
    Wait 1
    ListViewImage.Add(rs!Name, rs!Name, Picture[User.Home &/ "test" & i & ".png"].Image.Stretch(128, 72).Picture)
    
    rs.MoveNext 
  Loop 
Catch
  
End

Public Sub hGetFileClient_connect()
  
  ' Message("Started")
  
End 

Public Sub hGetFileClient_Error()
  
  hGetFileClient.Stop()
  Message("error")
  
End

Public Sub hGetFileClient_Finished()
  
  hGetFileClient.Stop()
  ' Message("done")
  'Catch
  
End 

Public Sub Button1_Click()
  
  DownloadFile
  
End
